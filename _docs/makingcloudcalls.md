---
title: "MakingCloudCalls"
---

Basic Calls
-----------

Generating a Client Key
-----------------------

Client keys can be generated by following the 'Create Key' link in the left hand bar of <http://dashboard.moaicloud.com/admin.php> . Creating a client key simply involves giving it a name to help you recognize it. The client key that is generated will contain a public 'key' and a private 'secret'. (These are not a cryptographic key pair - the 'public' portion of the client key is for identification purposes only and is mathematically unrelated to the 'private' key; the 'private' is just used for signing.)

The uses of each of these is detailed below.

Using a Client Key
------------------

Client keys are designed to allow callers to configure services. In order to pass your client key to a service you must first register the service with your key. Then when making calls to the service you'll need to include your key in the HTTP header of your call as x-clientkey or as the URL parameter clientkey. Client keys are required for all Moai Direct Services.

Signing Your Requests
---------------------

The client key you generate comes with a secret key. This secret is what you'll use to generate a signature for your calls. A signature is generated by base64 encoding a SHA256 HMAC generated from the uppercase HTTP method, the lowercase full URL (with path) and a string of all parameters (minus the signature) alphabetized, with each name and value URL encoded. Each element should then be URL encoded and all three parts then concatenated together with ampersands. The signature is then included in the call as an additional URL parameter named signature or a header named x-signature.

**NOTE**- When alphabetizing parameters, remember that all capital letters come before all lowercase letters. This means "Zebra" comes before "aardvark".

**NOTE**- You need to URL encode the final signature when including it as a URL parameter.

**NOTE**- URL Encoding involves hex encoding all non-alphanumeric characters except for '.' and '-'.

### Steps

POSTing to <HTTP://www.Example.com/signature> with post body of someParam=thisParam and email=user@example.com. Encoding with secret of "YourSecret"

```
1)  Start with HTTP method          - POST
2)  URL encode "POST"               - POST
3)  Append ampersand                - POST&
```
`4)  Lowercase URL                   - `[`http://www.example.com/signature`](http://www.example.com/signature)\
```
5)  URL Encode URL                  - http%3A%2F%2Fwww.example.com%2Fsignature
6)  Append to string                - POST&http%3A%2F%2Fwww.example.com%2Fsignature
7)  Append ampersand                - POST&http%3A%2F%2Fwww.example.com%2Fsignature&
8)  Alphabetize parameters          - email=user@example.com&someParam=thisParam
9)  URL Encode each parameter       - email=user%40example.com&someParam=thisParam
10) URL Encode parameter string     - email%3Duser%2540example.com%26someParam%3DthisParam
11) Append to string                - POST&http%3A%2F%2Fwww.example.com%2Fsignature&email%3Duser%2540example.com%26someParam%3DthisParam
12) SHA256 encrypt with your secret
13) Base64 encode                   - o+S30tB/J5G+SOgN76lSEhMmyzH5EA0ht2LhuzKJrcg=
14) Add x-signature header
15) Add x-clientkey header
16) Send request
```

### Example

Calling <HTTP://www.Example.com/signature?someParam=thisParam&anotherParam=thatParam&clientkey=MyClientKey>

```
Method = "GET"
URL = "`[`HTTP://www.Example.com/signature`](HTTP://www.Example.com/signature)`"
Parameter string = anotherParam=thatParam&clientkey=MyClientKey&someParam=thisParam

Signature = base64.encode(hmac.sha256("GET&http%3A%2F%2Fwww.example.com%2Fsignature&anotherParam%3DthatParam%26clientkey%3DMyClientKey%26someParam%3DthisParam","YourSecret"))
Signature result = a/3SBlZzRjpV5W+Q5bR169/FwUi2DeG7LFennYbg59M=
```
`Final Call = `[`http://www.example.com/signature?someParam=thisParam&anotherParam=thatParam&clientkey=MyClientKey&signature=a%2F3SBlZzRjpV5W%2BQ5bR169%2FFwUi2DeG7LFennYbg59M%3D`](http://www.example.com/signature?someParam=thisParam&anotherParam=thatParam&clientkey=MyClientKey&signature=a%2F3SBlZzRjpV5W%2BQ5bR169%2FFwUi2DeG7LFennYbg59M%3D)
